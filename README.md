# how-to-win-Numbers3-lottery
これはナンバーズ3でどのように買うか（買わないか）を調べるためのプログラム（エクセルvba）です。当てたいという方はぜひ使ってみてください（数字は出せますが、処理に30分以上かかる可能性があります。現在この処理を早くするために開発を続けています。よってこれはまだ完成品ではありません）。

---------------------------------------------------How to use---------------------------------------------------------------------------

Sheet5のセルのaw11の数字(1から210まで)を入力して、実行ボタンを押してみましょう。時間がかかる？　まだかかる？　30分かかりますからねぇ。気長に待ちましょう。結果が出ましたらportfolioというシートで確認してみましょう。(1+(aw11のセルの数字))列に数字がずらりと並んでいるのが分かります。すべてのボックス番号(105時間かかる！)を処理し終えたら、期待リターンが0よりボックス番号の数を数えましょう。その数を仮にaと置き、1/aの値を求めます。4828行のbunpaiというところに行きましょう。先ほど求めた値を(a+1)列までオートフィルしましょう。

1行目HD列にあるsumへ。仮に全部のボックス番号の期待リターンが0より大きいと仮定して2行目に言ってsumproduct関数を使いましょう。

はい、これを4815行までオートフィルしましょう。

これで分散投資のmが求まると思います。

以上が使い方です。

----------------------------------------------------------------------------------------------------------------------------------------

--------------------------------------------------------------原理----------------------------------------------------------------------

0.データはここからcsvをダウンロード　http://www.toe.jp/numbers34/download/

1.まず、当選番号を桁ごとに分割

2.次に、小さい順に並べます（154→145）。それをボックス番号と呼びます。

3.それぞれの期待リターンを求めます。求め方は当選番号（ボックス番号）と同じボックス番号であればその回のリターンは((当選金額/200)-1)、そうでなければ-1としてください。それですべての回のリターンが求まったなら、その平均を求めます。それが期待リターンです。期待リターンが求まったなら、それが高い順になるようにボックス番号を並び替えます（エクセルにあるリターンが以上に高いのは、当選金額をそのままリターンに計上しているだけで期待リターンを並び替えるのに問題ありません）。

4.さて、皆様お気づきでしょうが、期待リターンがマイナス(200未満)になっています。これは不必要なときに不必要なボックス番号を購入しているからです。そこで重要なのは、どのぐらい前に当選したら買わないか(ラグ)、どのぐらい買わないか(ブランク)を求めることです。期待リターンを最大化にするラグとブランクを求めること、それがこのプログラムの利用目的です。

5.例として、ボックス番号66の最適なラグは、1桁目(0)は25、2桁目は28、3桁目は30となります。また、最適なブランクは、1、2、1です。これはつまり、1桁目は25回前に当選したことがあれば1回だけ買わない、2桁目は28回前に当選したことがあれば2回だけ買わない、3桁目は30回前に当選したことがあれば1回だけ買わないということになります。さて、この時の期待リターンはというと、なんと驚きの37％！　ヤッター！　しかしちょっと待ってください。調べると、当選したのはたったの25回。偶然なんじゃないですかと思われた方も多いはず。実際標準偏差は1218％もあります。大丈夫なのか？　そこで私はt分布95％信頼区間の下限を求めることにしました。

6.標本数n=4814、下限値をmとすると、m=(標本期待リターン)-1.96*(標本標準偏差)/(4814)^(1/2)となります。m>0ならそのまま使ってもOK。しかし、大体はm<0なので工夫が必要です。

7.分散投資をしましょう。分散投資をすると、標準偏差が小さくなってmが大きくなります。ここでいう分散投資は複数のボックス番号を購入することです。

----------------------------------------------------------------------------------------------------------------------------------------

最後に、これは未完成品です。今後改良して早く処理できるようにしていきます。予想としては1ボックス番号5分です。よろしくお願いいたします。
